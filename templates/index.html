<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…ÙˆÙ†ÙˆØ¨ÙˆÙ„ÙŠ Ø°ÙŠ Ù‚Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .hidden { display: none !important; }
        
        /* Ø®Ø±ÙŠØ·Ø© 11x11 Ù…ØªØ¬Ø§ÙˆØ¨Ø© Ø³ÙŠØ¯ÙŠ */
        .board { display: grid; grid-template-columns: repeat(11, 1fr); grid-template-rows: repeat(11, 1fr); width: 98vw; height: 98vw; background: #2ecc71; border: 4px solid #27ae60; margin: 5px auto; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .cell { background: #f9f9f9; border: 0.1px solid #bdc3c7; color: #2c3e50; font-size: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; font-weight: bold; text-align: center; }
        .price-tag { color: #27ae60; font-size: 4px; margin-top: 1px; }
        .owner-tag { position: absolute; top: 0; width: 100%; height: 4px; z-index: 5; }
        .token { width: 12px; height: 12px; border-radius: 50%; border: 1.5px solid white; position: absolute; z-index: 100; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        
        /* Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø³ÙÙ„ÙŠ Ø³ÙŠØ¯ÙŠ Ù„Ù„Ù†Ø±Ø¯ ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        #controls { background: #2c3e50; padding: 12px; display: flex; justify-content: space-around; align-items: center; border-top: 4px solid #e67e22; position: fixed; bottom: 0; width: 100%; z-index: 1000; box-sizing: border-box; }
        .dice-btn { background: #e67e22; padding: 10px 20px; border-radius: 8px; font-weight: bold; border: none; color: white; font-size: 16px; cursor: pointer; transition: 0.2s; }
        .dice-btn:active { transform: scale(0.9); }
        .dice-val { font-size: 30px; background: white; color: #333; padding: 5px 15px; border-radius: 8px; border: 2px solid #e67e22; min-width: 45px; text-align: center; font-weight: bold; }
        .shake { animation: shake 0.3s infinite; }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0); } }
    </style>
</head>
<body>

<div id="lobby" style="text-align: center; padding-top: 80px;">
    <h1 style="color: #e67e22; font-size: 2.5em;">ğŸ›ï¸ Ø°ÙŠ Ù‚Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h1>
    <p>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø³ÙŠØ¯ÙŠ</p>
    <input id="p-name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ù„ÙƒÙŠ" style="padding: 12px; margin: 10px; width: 200px; border-radius: 8px; border: none;">
    <input id="r-id" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©" style="padding: 12px; margin: 10px; width: 200px; border-radius: 8px; border: none;">
    <br>
    <button onclick="enterGame()" style="padding: 15px 50px; background: #e67e22; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold;">Ø¨Ø¯Ø¡ Ø§Ù„ØºØ²ÙˆØ§Øª</button>
</div>

<div id="game-screen" class="hidden">
    <div class="board" id="board"></div>
    <div id="controls">
        <div style="text-align: right;">
            <div id="money-info" style="color: #2ecc71; font-size: 22px; font-weight: bold;">ğŸ’° 2000$</div>
            <div id="turn-txt" style="font-size: 11px; color: #ecf0f1;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¯ÙˆØ±Ùƒ...</div>
        </div>
        <div id="dice-box" class="dice-val">ğŸ²</div>
        <button id="roll-btn" class="dice-btn" onclick="roll()">Ø§Ø±Ù…ÙŠ Ø§Ù„Ø²Ø§Ø±</button>
    </div>
</div>

<script>
    const socket = io();
    let myRoom, myName, myColor = '#' + Math.floor(Math.random()*16777215).toString(16);
    let playerPositions = {};

    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù€ 40 Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø³ÙŠØ¯ÙŠ
    const names = ["Ø§Ù„Ø«ÙˆØ±Ø©", "Ø§Ù„Ø´Ù…ÙˆØ®", "Ø£Ø±ÙŠØ¯Ùˆ", "Ø§Ù„Ø³ÙƒÙƒ", "Ø³ÙˆÙ…Ø±", "Ø§Ù„Ù…Ù†ØµÙˆØ±ÙŠØ©", "Ø§Ù„Ø­Ø¨ÙˆØ¨ÙŠ", "Ø§Ù„Ø¬Ø¨Ø§ÙŠØ´", "Ø³ÙˆÙ‚ Ø§Ù„Ø´ÙŠÙˆØ®", "Ø§Ù„Ø¥Ø³ÙƒØ§Ù†", "Ø£ÙˆØ±", "Ø§Ù„ÙÙ‡ÙˆØ¯", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ø±ÙØ§Ø¹ÙŠ", "Ø§Ù„Ø´Ø·Ø±Ø©", "Ø§Ù„ØºØ¯ÙŠØ±", "Ø§Ù„Ø¥ØµÙ„Ø§Ø­", "Ù‚Ù„Ø¹Ø© Ø³ÙƒØ±", "Ø§Ù„Ø¯ÙˆØ§ÙŠØ©", "Ø§Ù„Ø¨Ø·Ø­Ø§Ø¡"];
    const zones = [];
    for(let i=0; i<40; i++) {
        if(i === 0) zones.push({n: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", t: "start", i: "ğŸš©", p: 0});
        else if(i === 10) zones.push({n: "Ø³Ø¬Ù† Ø§Ù„Ø­ÙˆØª", t: "jail", i: "â›“ï¸", p: 0});
        else if(i === 20) zones.push({n: "Ù…ÙˆØ§Ù‚Ù Ù…Ø¬Ø§Ù†ÙŠØ©", t: "park", i: "ğŸ…¿ï¸", p: 0});
        else if(i === 30) zones.push({n: "Ø§Ø°Ù‡Ø¨ Ù„Ù„Ø³Ø¬Ù†!", t: "to_jail", i: "ğŸ‘®", p: 0});
        else if(i % 5 === 0 && i % 10 !== 0) zones.push({n: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸", t: "luck", i: "ğŸ“¦", p: 0});
        else if(i % 5 === 5 || i === 5 || i === 15 || i === 25 || i === 35) zones.push({n: "Ù…Ø­Ø·Ø© Ø§Ù„Ù‚Ø·Ø§Ø±", t: "p", i: "ğŸš‰", p: 200});
        else zones.push({n: names[i % names.length], t: "p", p: 100 + (i*12), i: "ğŸ˜ï¸"});
    }

    function enterGame() {
        myRoom = document.getElementById('r-id').value;
        myName = document.getElementById('p-name').value;
        if(!myRoom || !myName) return alert("Ø³ÙŠØ¯ÙŠØŒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹!");
        socket.emit('create_room', {room: myRoom});
        socket.emit('join_game', {room: myRoom, name: myName, color: myColor});
    }

    socket.on('join_success', () => {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-screen').classList.remove('hidden');
        renderBoard();
    });

    function renderBoard() {
        const b = document.getElementById('board'); b.innerHTML = "";
        for(let i=0; i<40; i++) {
            let r, c;
            if(i<11) { r=1; c=i+1; } else if(i<20) { r=i-9; c=11; } else if(i<31) { r=11; c=31-i; } else { r=41-i; c=1; }
            let d = document.createElement('div'); d.className = 'cell'; d.id = 'z-' + i;
            d.style.gridRow = r; d.style.gridColumn = c;
            d.innerHTML = `<div class="owner-tag" id="tag-${i}"></div><span style="font-size: 8px;">${zones[i].i}</span><div style="transform: scale(0.8)">${zones[i].n}</div><div class="price-tag">${zones[i].p ? zones[i].p+'$' : ''}</div>`;
            b.appendChild(d);
        }
    }

    function roll() {
        document.getElementById('dice-box').classList.add('shake');
        socket.emit('roll_dice', {room: myRoom});
    }

    socket.on('dice_result', async (data) => {
        const p = data.game.players.find(pl => pl.name === data.roller);
        document.getElementById('dice-box').classList.remove('shake');
        document.getElementById('dice-box').innerText = data.steps;
        
        let currentPos = playerPositions[p.name] || 0;
        for(let i=0; i<data.steps; i++) {
            currentPos = (currentPos + 1) % 40;
            updateUI(p.name, currentPos, p.color);
            await new Promise(r => setTimeout(r, 250)); // Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø´ÙŠ Ø³ÙŠØ¯ÙŠ
        }
        playerPositions[p.name] = p.pos;
        if(data.roller === myName) handleAction(p.pos, data.game);
    });

    function updateUI(name, pos, color) {
        let old = document.getElementById('t-' + name); if(old) old.remove();
        let t = document.createElement('div'); t.className = 'token'; t.id = 't-' + name;
        t.style.background = color;
        document.getElementById('z-' + pos).appendChild(t);
    }

    function handleAction(pos, game) {
        const zone = zones[pos];
        if(zone.t === 'p' && !game.properties[pos]) {
            if(confirm(`Ù‡Ù„ ØªÙˆØ¯ Ø´Ø±Ø§Ø¡ ${zone.n} Ø¨Ù€ ${zone.p}$ Ø³ÙŠØ¯ÙŠØŸ`)) {
                socket.emit('buy_land', {room: myRoom, name: myName, price: zone.p, land_name: zone.n});
            }
        } else if(zone.t === 'luck') {
            let win = (Math.floor(Math.random()*6)+1)*40;
            alert(`ğŸ“¦ Ø§Ù„Ø­Ø¸ Ø§Ø¨ØªØ³Ù… Ù„Ùƒ: Ø±Ø¨Ø­Øª ${win}$ Ø³ÙŠØ¯ÙŠ!`);
            socket.emit('update_money', {room: myRoom, name: myName, amount: win});
        }
    }

    socket.on('update_game', (game) => {
        game.players.forEach(p => {
            if(!playerPositions[p.name]) updateUI(p.name, p.pos, p.color);
            if(p.name === myName) document.getElementById('money-info').innerText = "ğŸ’° " + p.money + "$";
        });
        for(let pos in game.properties) {
            const owner = game.players.find(pl => pl.name === game.properties[pos]);
            if(owner) document.getElementById('tag-'+pos).style.background = owner.color;
        }
        const turnP = game.players[game.turn];
        document.getElementById('turn-txt').innerText = "Ø¯ÙˆØ± Ø§Ù„Ù…Ù„Ùƒ: " + turnP.name;
        document.getElementById('roll-btn').disabled = (turnP.name !== myName);
    });
</script>
</body>
</html>
