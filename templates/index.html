<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…ÙˆÙ†ÙˆØ¨ÙˆÙ„ÙŠ Ø°ÙŠ Ù‚Ø§Ø± - Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ±Ù</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Cairo', sans-serif; text-align: center; }
        #lobby { margin-top: 100px; }
        .hidden { display: none !important; }
        #game-ui { display: flex; padding: 20px; justify-content: space-around; }
        .board { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); width: 500px; height: 500px; background: #27ae60; border: 8px solid #1e8449; }
        .cell { background: white; border: 1px solid #2c3e50; color: #333; font-size: 11px; font-weight: bold; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .middle { grid-column: 2/5; grid-row: 2/5; background: #2ecc71; color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        .token { width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; position: absolute; transition: 0.5s; }
        input, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; }
        button { background: #e67e22; color: white; cursor: pointer; }
    </style>
</head>
<body>

<div id="lobby">
    <h1>ğŸ›ï¸ Ø±Ø¯Ù‡Ø© Ù…ÙˆÙ†ÙˆØ¨ÙˆÙ„ÙŠ Ø°ÙŠ Ù‚Ø§Ø±</h1>
    <input id="p-name" placeholder="Ø§Ø³Ù…Ùƒ Ø³ÙŠØ¯ÙŠ">
    <input id="r-id" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©">
    <br>
    <button onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© â•</button>
    <button onclick="joinRoom()">Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨ ğŸ®</button>
</div>

<div id="game-screen" class="hidden">
    <div id="game-ui">
        <div class="board" id="board">
            <div class="middle">Ø°ÙŠ Ù‚Ø§Ø±</div>
        </div>
        <div id="controls" style="width: 300px; background: #2c3e50; padding: 20px; border-radius: 15px;">
            <h3 id="turn-info">Ø§Ù†ØªØ¸Ø± Ø¯ÙˆØ±Ùƒ...</h3>
            <div id="dice-val" style="font-size: 50px;">ğŸ²</div>
            <button id="roll-btn" onclick="roll()">Ø§Ø±Ù…ÙŠ Ø§Ù„Ø²Ø§Ø±</button>
            <hr>
            <div id="player-stats"></div>
        </div>
    </div>
</div>

<script>
    const socket = io();
    let myRoom = "";
    let myName = "";
    const myColor = '#' + Math.floor(Math.random()*16777215).toString(16);

    const zones = [
        {n: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", t: "start", i: "ğŸš©"}, {n: "Ø§Ù„Ø­Ø¨ÙˆØ¨ÙŠ", t: "p", p: 400, i: "ğŸ›ï¸"}, {n: "Ù‚Ø·Ø§Ø± Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©", t: "r", p: 200, i: "ğŸš‚"}, {n: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸", t: "c", i: "ğŸ“¦"},
        {n: "Ø§Ù„Ø´Ø·Ø±Ø©", t: "p", p: 250, i: "ğŸŒ¾"}, {n: "Ø³ÙˆÙ‚ Ø§Ù„Ø´ÙŠÙˆØ®", t: "p", p: 200, i: "ğŸ›’"}, {n: "Ø§Ù„Ø¬Ø¨Ø§ÙŠØ´", t: "p", p: 300, i: "ğŸš£"}, {n: "Ø³Ø¬Ù† Ø§Ù„Ø­ÙˆØª", t: "jail", i: "â›“ï¸"},
        {n: "Ø§Ù„Ø±ÙØ§Ø¹ÙŠ", t: "p", p: 150, i: "ğŸ•Œ"}, {n: "Ù‚Ù„Ø¹Ø© Ø³ÙƒØ±", t: "p", p: 180, i: "ğŸ°"}, {n: "Ù‚Ø·Ø§Ø± Ø§Ù„ØºØ±Ø§Ù", t: "r", p: 200, i: "ğŸš‚"}, {n: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸", t: "c", i: "ğŸ“¦"},
        {n: "Ø§Ù„Ø¨Ø·Ø­Ø§Ø¡", t: "p", p: 120, i: "ğŸ"}, {n: "Ø§Ù„Ù†ØµØ±", t: "p", p: 130, i: "âœŒï¸"}, {n: "Ø§Ù„ÙØ¬Ø±", t: "p", p: 110, i: "ğŸŒ…"}, {n: "ØªØ°ÙƒØ±Ø© Ø³ÙØ±", t: "tax", i: "ğŸ«"}
    ];

    function createRoom() {
        myRoom = document.getElementById('r-id').value;
        if(!myRoom) return alert("Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ© Ø³ÙŠØ¯ÙŠ");
        socket.emit('create_room', {room: myRoom});
        joinRoom();
    }

    function joinRoom() {
        myName = document.getElementById('p-name').value;
        myRoom = document.getElementById('r-id').value;
        if(!myName || !myRoom) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ¯ÙŠ");
        socket.emit('join_game', {room: myRoom, name: myName, color: myColor});
        document.getElementById('lobby').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        renderBoard();
    }

    function renderBoard() {
        const b = document.getElementById('board');
        const positions = [[1,1],[1,2],[1,3],[1,4],[1,5],[2,5],[3,5],[4,5],[5,5],[5,4],[5,3],[5,2],[5,1],[4,1],[3,1],[2,1]];
        zones.forEach((z, i) => {
            let d = document.createElement('div');
            d.className = 'cell';
            d.id = 'z-' + i;
            d.style.gridRow = positions[i][0];
            d.style.gridColumn = positions[i][1];
            d.innerHTML = `<span>${z.i}</span><br>${z.n}`;
            b.appendChild(d);
        });
    }

    function roll() { socket.emit('roll_dice', {room: myRoom}); }

    socket.on('update_game', (game) => { updateUI(game); });
    socket.on('dice_result', (data) => {
        document.getElementById('dice-val').innerText = data.steps;
        updateUI(data.game);
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¹Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø©
        const p = data.game.players.find(pl => pl.name === data.roller);
        if(data.roller === myName) {
            const zone = zones[p.pos];
            if(zone.t === 'p' || zone.t === 'r') {
                if(confirm(`Ù‡Ù„ ØªØ´ØªØ±ÙŠ ${zone.n} Ø¨Ø³Ø¹Ø± ${zone.p}$ Ø³ÙŠØ¯ÙŠØŸ`)) {
                    // Ù‡Ù†Ø§ Ù†Ø±Ø³Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡ Ù„Ù„Ø³ÙŠØ±ÙØ± (Ø³Ù†Ø·ÙˆØ±Ù‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©)
                    alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø³ÙŠØ¯ÙŠ (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)");
                }
            }
        }
    });

    function updateUI(game) {
        document.querySelectorAll('.token').forEach(t => t.remove());
        game.players.forEach(p => {
            let t = document.createElement('div');
            t.className = 'token';
            t.style.background = p.color;
            document.getElementById('z-' + p.pos).appendChild(t);
        });
        const turnPlayer = game.players[game.turn];
        document.getElementById('turn-info').innerText = "Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¢Ù† Ù„Ù€: " + turnPlayer.name;
        document.getElementById('roll-btn').disabled = (turnPlayer.name !== myName);
    }
</script>
</body>
    </html>
