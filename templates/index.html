<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø°ÙŠ Ù‚Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ© Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .hidden { display: none !important; }
        .board { display: grid; grid-template-columns: repeat(11, 1fr); grid-template-rows: repeat(11, 1fr); width: 98vw; height: 98vw; background: #27ae60; border: 3px solid #1e8449; margin: 5px auto; position: relative; }
        .cell { background: white; border: 0.1px solid #ccc; color: #333; font-size: 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; font-weight: bold; overflow: hidden; }
        .price-tag { color: #27ae60; font-size: 4px; }
        .owner-tag { position: absolute; top: 0; width: 100%; height: 4px; }
        /* ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø³ÙŠØ¯ÙŠ */
        .board-center { grid-column: 2 / 11; grid-row: 2 / 11; background: url('https://i.imgur.com/G9L6TfH.png') center/contain no-repeat; display: flex; align-items: center; justify-content: center; opacity: 0.9; }
        .token { width: 10px; height: 10px; border-radius: 50%; border: 1px solid white; position: absolute; z-index: 100; transition: all 0.3s ease; }
        #controls { background: #1e272e; padding: 10px; display: flex; justify-content: space-around; align-items: center; border-top: 3px solid #e67e22; position: fixed; bottom: 0; width: 100%; box-sizing: border-box; }
        .dice-btn { background: #e67e22; padding: 10px 20px; border-radius: 8px; border: none; color: white; font-weight: bold; }
        .dice-num { font-size: 25px; background: white; color: #333; padding: 0 10px; border-radius: 5px; border: 2px solid #e67e22; }
        .shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0%, 100% { transform: rotate(0); } 50% { transform: rotate(10deg); } }
    </style>
</head>
<body>

<div id="lobby" style="text-align: center; padding-top: 50px;">
    <h1 style="color: #e67e22;">ğŸ›ï¸ Ø°ÙŠ Ù‚Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h1>
    <input id="p-name" placeholder="Ø§Ø³Ù…Ùƒ Ø³ÙŠØ¯ÙŠ" style="padding: 10px; margin: 5px;">
    <input id="r-id" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©" style="padding: 10px; margin: 5px;">
    <button onclick="enter()" style="padding: 10px 30px; background: #e67e22; border: none; color: white;">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="game-screen" class="hidden">
    <div class="board" id="board">
        <div class="board-center"><h1 style="color: #2c3e50; font-size: 15px;">Ø°ÙŠ Ù‚Ø§Ø±</h1></div>
    </div>
    <div id="controls">
        <div>
            <div id="money-info" style="color: #2ecc71; font-weight: bold; font-size: 18px;">ğŸ’° 2000$</div>
            <div id="turn-txt" style="font-size: 9px; color: #bdc3c7;">Ø§Ù†ØªØ¸Ø± Ø¯ÙˆØ±Ùƒ...</div>
        </div>
        <div id="dice-val" class="dice-num">ğŸ²</div>
        <button id="roll-btn" class="dice-btn" onclick="roll()">Ø§Ø±Ù…ÙŠ Ø³ÙŠØ¯ÙŠ</button>
    </div>
</div>

<script>
    const socket = io();
    let myRoom, myName, myColor = '#' + Math.floor(Math.random()*16777215).toString(16);
    let playerPositions = {};

    const names = ["Ø§Ù„Ø«ÙˆØ±Ø©", "Ø§Ù„Ø´Ù…ÙˆØ®", "Ø£Ø±ÙŠØ¯Ùˆ", "Ø§Ù„Ø³ÙƒÙƒ", "Ø³ÙˆÙ…Ø±", "Ø§Ù„Ù…Ù†ØµÙˆØ±ÙŠØ©", "Ø§Ù„Ø­Ø¨ÙˆØ¨ÙŠ", "Ø§Ù„Ø¬Ø¨Ø§ÙŠØ´", "Ø³ÙˆÙ‚ Ø§Ù„Ø´ÙŠÙˆØ®", "Ø§Ù„Ø¥Ø³ÙƒØ§Ù†", "Ø£ÙˆØ±", "Ø§Ù„ÙÙ‡ÙˆØ¯", "Ø§Ù„Ù†ØµØ±", "Ø§Ù„Ø±ÙØ§Ø¹ÙŠ", "Ø§Ù„Ø´Ø·Ø±Ø©", "Ø§Ù„ØºØ¯ÙŠØ±"];
    const zones = [];
    for(let i=0; i<40; i++) {
        if(i === 0) zones.push({n: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", t: "start", i: "ğŸš©", p: 0});
        else if(i === 10) zones.push({n: "Ø³Ø¬Ù† Ø§Ù„Ø­ÙˆØª", t: "jail", i: "â›“ï¸", p: 0});
        else if(i === 20) zones.push({n: "Ù…ÙˆØ§Ù‚Ù", t: "park", i: "ğŸ…¿ï¸", p: 0});
        else if(i === 30) zones.push({n: "Ù„Ù„Ø³Ø¬Ù†!", t: "to_jail", i: "ğŸ‘®", p: 0});
        else if(i % 5 === 0) zones.push({n: "Ø­Ø¸", t: "luck", i: "ğŸ“¦", p: 0});
        else zones.push({n: names[i%names.length], t: "p", p: 100 + (i*15), i: "ğŸ˜ï¸"});
    }

    function enter() {
        myRoom = document.getElementById('r-id').value;
        myName = document.getElementById('p-name').value;
        socket.emit('create_room', {room: myRoom});
        socket.emit('join_game', {room: myRoom, name: myName, color: myColor});
    }

    socket.on('join_success', () => {
        document.getElementById('lobby').style.display='none';
        document.getElementById('game-screen').classList.remove('hidden');
        renderBoard();
    });

    function renderBoard() {
        const b = document.getElementById('board'); 
        for(let i=0; i<40; i++) {
            let r, c;
            if(i<11) { r=1; c=i+1; } else if(i<20) { r=i-9; c=11; } else if(i<31) { r=11; c=31-i; } else { r=41-i; c=1; }
            let d = document.createElement('div'); d.className = 'cell'; d.id = 'z-' + i;
            d.style.gridRow = r; d.style.gridColumn = c;
            d.innerHTML = `<div class="owner-tag" id="tag-${i}"></div><span>${zones[i].i}</span><div style="transform: scale(0.7)">${zones[i].n}</div><div class="price-tag">${zones[i].p ? zones[i].p+'$' : ''}</div>`;
            b.appendChild(d);
        }
    }

    function roll() {
        document.getElementById('dice-val').classList.add('shake');
        socket.emit('roll_dice', {room: myRoom});
    }

    socket.on('dice_result', async (data) => {
        const p = data.game.players.find(pl => pl.name === data.roller);
        document.getElementById('dice-val').classList.remove('shake');
        document.getElementById('dice-val').innerText = data.steps;
        
        let currentPos = playerPositions[p.name] || 0;
        for(let i=0; i<data.steps; i++) {
            currentPos = (currentPos + 1) % 40;
            updateUI(p.name, currentPos, p.color);
            await new Promise(r => setTimeout(r, 200));
        }
        playerPositions[p.name] = p.pos;
        if(data.roller === myName) checkAction(p.pos, data.game);
    });

    function updateUI(name, pos, color) {
        let old = document.getElementById('t-' + name); if(old) old.remove();
        let t = document.createElement('div'); t.className = 'token'; t.id = 't-' + name;
        t.style.background = color;
        document.getElementById('z-' + pos).appendChild(t);
    }

    function checkAction(pos, game) {
        const zone = zones[pos];
        if(zone.t === 'p' && !game.properties[pos]) {
            if(confirm(`Ù‡Ù„ ØªØ´ØªØ±ÙŠ ${zone.n} Ø¨Ù€ ${zone.p}$ Ø³ÙŠØ¯ÙŠØŸ`)) {
                socket.emit('buy_land', {room: myRoom, name: myName, price: zone.p, land_name: zone.n});
            }
        } else if(zone.t === 'luck') {
            let win = (Math.floor(Math.random()*5)+1)*50;
            alert(`ğŸ“¦ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸: Ø±Ø¨Ø­Øª ${win}$!`);
            socket.emit('update_money', {room: myRoom, name: myName, amount: win});
        }
    }

    socket.on('update_game', (game) => {
        game.players.forEach(p => {
            if(!playerPositions[p.name]) updateUI(p.name, p.pos, p.color);
            if(p.name === myName) document.getElementById('money-info').innerText = "ğŸ’° " + p.money + "$";
        });
        for(let pos in game.properties) {
            const owner = game.players.find(pl => pl.name === game.properties[pos]);
            if(owner) document.getElementById('tag-'+pos).style.background = owner.color;
        }
        const turnP = game.players[game.turn];
        document.getElementById('turn-txt').innerText = "Ø¯ÙˆØ± Ø§Ù„Ù…Ù„Ùƒ: " + turnP.name;
        document.getElementById('roll-btn').disabled = (turnP.name !== myName);
    });
</script>
</body>
</html>
