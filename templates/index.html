<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…ÙˆÙ†ÙˆØ¨ÙˆÙ„ÙŠ Ø°ÙŠ Ù‚Ø§Ø± - Ø§Ù„Ù…Ù„ÙƒÙŠØ©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { background: #121212; color: white; font-family: 'Cairo', sans-serif; margin: 0; overflow: hidden; }
        .hidden { display: none !important; }
        #game-screen { display: flex; height: 100vh; padding: 10px; }
        .board { display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(6, 1fr); flex: 2; background: #27ae60; border: 10px solid #1e8449; gap: 2px; }
        .cell { background: white; color: #333; font-size: 11px; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 1px solid #ccc; }
        .owner-tag { position: absolute; top: 0; width: 100%; height: 5px; }
        .token { width: 22px; height: 22px; border-radius: 50%; border: 2px solid white; position: absolute; transition: 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        #side-panel { flex: 1; background: #1e272e; margin-left: 10px; padding: 20px; border-radius: 15px; border: 2px solid #e67e22; }
        .dice-anim { animation: roll 0.4s infinite; }
        @keyframes roll { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }
        button { background: #e67e22; color: white; padding: 15px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 18px; }
    </style>
</head>
<body>

<div id="lobby" style="padding-top: 100px; text-align: center;">
    <h1>ğŸ›ï¸ Ø±Ø¯Ù‡Ø© Ø°ÙŠ Ù‚Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h1>
    <input id="p-name" placeholder="Ø§Ø³Ù…Ùƒ Ø³ÙŠØ¯ÙŠ" style="padding: 10px;">
    <input id="r-id" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©" style="padding: 10px;">
    <button onclick="createRoom()" style="width: auto;">Ø¥Ù†Ø´Ø§Ø¡</button>
    <button onclick="joinRoom()" style="width: auto;">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
</div>

<div id="game-screen" class="hidden">
    <div class="board" id="board"></div>
    <div id="side-panel">
        <h2 id="turn-txt">Ø§Ù†ØªØ¸Ø±...</h2>
        <div id="dice-box" style="font-size: 60px; margin: 20px;">ğŸ²</div>
        <button id="roll-btn" onclick="roll()">Ø§Ø±Ù…ÙŠ Ø§Ù„Ø²Ø§Ø± Ø³ÙŠØ¯ÙŠ</button>
        <hr>
        <div id="money-info" style="font-size: 24px; color: #2ecc71;">ÙÙ„ÙˆØ³Ùƒ: 1500$</div>
        <div id="game-logs" style="font-size: 12px; color: #bdc3c7; height: 100px; overflow-y: auto; margin-top: 10px;"></div>
    </div>
</div>

<script>
    const socket = io();
    let myRoom, myName, myColor = '#' + Math.floor(Math.random()*16777215).toString(16);

    // Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù†Ø§ØµØ±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø³ÙŠØ¯ÙŠ
    const zones = [
        {n: "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", t: "start", i: "ğŸš©"}, {n: "Ø§Ù„Ø«ÙˆØ±Ø©", t: "p", p: 400, i: "ğŸ˜ï¸"}, {n: "Ø§Ù„Ø´Ù…ÙˆØ®", t: "p", p: 350, i: "ğŸ™ï¸"}, {n: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸", t: "luck", i: "ğŸ“¦"}, {n: "Ø§Ù„Ø³ÙƒÙƒ", t: "p", p: 300, i: "ğŸ›¤ï¸"}, {n: "Ø£Ø±ÙŠØ¯Ùˆ", t: "p", p: 280, i: "ğŸ "},
        {n: "Ø³ÙˆÙ…Ø±", t: "p", p: 250, i: "ğŸº"}, {n: "Ø³ÙˆÙ‚ Ø§Ù„Ø´ÙŠÙˆØ®", t: "p", p: 200, i: "ğŸ›’"}, {n: "Ø§Ù„Ø¬Ø¨Ø§ÙŠØ´", t: "p", p: 220, i: "ğŸš£"}, {n: "Ø³Ø¬Ù† Ø§Ù„Ø­ÙˆØª", t: "jail", i: "â›“ï¸"},
        {n: "Ø§Ù„Ø±ÙØ§Ø¹ÙŠ", t: "p", p: 180, i: "ğŸ•Œ"}, {n: "Ù‚Ù„Ø¹Ø© Ø³ÙƒØ±", t: "p", p: 170, i: "ğŸ°"}, {n: "Ø§Ù„Ù…Ù†ØµÙˆØ±ÙŠØ©", t: "p", p: 200, i: "ğŸ¢"}, {n: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸", t: "luck", i: "ğŸ“¦"},
        {n: "Ø§Ù„Ø¨Ø·Ø­Ø§Ø¡", t: "p", p: 120, i: "ğŸ"}, {n: "Ø§Ù„Ù†ØµØ±", t: "p", p: 130, i: "âœŒï¸"}, {n: "Ø§Ù„ÙØ¬Ø±", t: "p", p: 110, i: "ğŸŒ…"}, {n: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø­Ø¨ÙˆØ¨ÙŠ", t: "p", p: 500, i: "ğŸ›ï¸"},
        {n: "Ø§Ù„Ø¥Ø³ÙƒØ§Ù†", t: "p", p: 320, i: "ğŸ¢"}, {n: "ØªØ°ÙƒØ±Ø© Ø³ÙØ±", t: "tax", i: "ğŸ«"}
    ];

    function createRoom() { myRoom = document.getElementById('r-id').value; socket.emit('create_room', {room: myRoom}); }
    function joinRoom() { 
        myName = document.getElementById('p-name').value; myRoom = document.getElementById('r-id').value;
        socket.emit('join_game', {room: myRoom, name: myName, color: myColor});
    }

    socket.on('join_success', (d) => { 
        if(d.success) { document.getElementById('lobby').classList.add('hidden'); document.getElementById('game-screen').classList.remove('hidden'); renderBoard(); }
    });

    function renderBoard() {
        const b = document.getElementById('board'); b.innerHTML = "";
        const posMap = [[1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[2,6],[3,6],[4,6],[5,6],[6,6],[6,5],[6,4],[6,3],[6,2],[6,1],[5,1],[4,1],[3,1],[2,1]];
        zones.forEach((z, i) => {
            let d = document.createElement('div'); d.className = 'cell'; d.id = 'z-' + i;
            d.style.gridRow = posMap[i][0]; d.style.gridColumn = posMap[i][1];
            d.innerHTML = `<div class="owner-tag" id="tag-${i}"></div><span>${z.i}</span><br>${z.n}<br><small>${z.p ? z.p+'$' : ''}</small>`;
            b.appendChild(d);
        });
    }

    function roll() {
        const btn = document.getElementById('roll-btn'); btn.disabled = true;
        document.getElementById('dice-box').classList.add('dice-anim');
        setTimeout(() => { socket.emit('roll_dice', {room: myRoom}); }, 600);
    }

    socket.on('dice_result', (data) => {
        document.getElementById('dice-box').classList.remove('dice-anim');
        document.getElementById('dice-box').innerText = data.steps;
        updateUI(data.game);
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø³ÙŠØ¯ÙŠ
        const p = data.game.players.find(pl => pl.name === data.roller);
        if(data.roller === myName) {
            const zone = zones[p.pos];
            if(zone.t === 'p' && !data.game.properties[p.pos]) {
                if(confirm(`Ù‡Ù„ ØªØ´ØªØ±ÙŠ ${zone.n} Ø¨Ø³Ø¹Ø± ${zone.p}$ Ø³ÙŠØ¯ÙŠØŸ`)) {
                    socket.emit('buy_land', {room: myRoom, name: myName, price: zone.p, land_name: zone.n});
                }
            } else if(zone.t === 'luck') {
                alert("ğŸ“¦ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø­Ø¸: Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 200$ Ø¹ÙŠØ¯ÙŠØ© Ù…Ù† Ø§Ù„Ù†Ø§ØµØ±ÙŠØ©!");
            }
        }
    });

    function updateUI(game) {
        document.querySelectorAll('.token').forEach(t => t.remove());
        game.players.forEach(p => {
            let t = document.createElement('div'); t.className = 'token'; t.style.background = p.color;
            document.getElementById('z-' + p.pos).appendChild(t);
            if(p.name === myName) document.getElementById('money-info').innerText = "ÙÙ„ÙˆØ³Ùƒ: " + p.money + "$";
        });
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø§Ùƒ
        for(let pos in game.properties) {
            const ownerName = game.properties[pos];
            const color = game.players.find(pl => pl.name === ownerName).color;
            document.getElementById('tag-'+pos).style.background = color;
        }
        const turnP = game.players[game.turn];
        document.getElementById('turn-txt').innerText = "Ø¯ÙˆØ±: " + turnP.name;
        document.getElementById('roll-btn').disabled = (turnP.name !== myName);
    }

    socket.on('log', (d) => {
        const l = document.getElementById('game-logs');
        l.innerHTML = `<div>${d.msg}</div>` + l.innerHTML;
    });
</script>
</body>
</html>
